import{C as O,M as r,V as o,a as n,Q as M,b as f}from"./index-Bqf-o3MB.js";const u={type:"change"},E={type:"start"},b={type:"end"},P=1e-6,s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},p=new n,h=new n,S=new o,_=new o,y=new o,a=new M,w=new o,m=new o,g=new o,l=new o;class X extends O{constructor(t,i=null){super(t,i),this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:r.ROTATE,MIDDLE:r.DOLLY,RIGHT:r.PAN},this.target=new o,this.state=s.NONE,this.keyState=s.NONE,this._lastPosition=new o,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new o,this._movePrev=new n,this._moveCurr=new n,this._lastAxis=new o,this._zoomStart=new n,this._zoomEnd=new n,this._panStart=new n,this._panEnd=new n,this._pointers=[],this._pointerPositions={},this._onPointerMove=j.bind(this),this._onPointerDown=C.bind(this),this._onPointerUp=T.bind(this),this._onPointerCancel=k.bind(this),this._onContextMenu=L.bind(this),this._onMouseWheel=N.bind(this),this._onKeyDown=z.bind(this),this._onKeyUp=D.bind(this),this._onTouchStart=U.bind(this),this._onTouchMove=R.bind(this),this._onTouchEnd=Y.bind(this),this._onMouseDown=A.bind(this),this._onMouseMove=x.bind(this),this._onMouseUp=Z.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,i!==null&&(this.connect(i),this.handleResize()),this.update()}connect(t){super.connect(t),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const t=this.domElement.getBoundingClientRect(),i=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-i.clientLeft,this.screen.top=t.top+window.pageYOffset-i.clientTop,this.screen.width=t.width,this.screen.height=t.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>P&&(this.dispatchEvent(u),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>P||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(u),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=s.NONE,this.keyState=s.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(u),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(h.copy(this._panEnd).sub(this._panStart),h.lengthSq()){if(this.object.isOrthographicCamera){const t=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,i=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;h.x*=t,h.y*=i}h.multiplyScalar(this._eye.length()*this.panSpeed),_.copy(this._eye).cross(this.object.up).setLength(h.x),_.add(S.copy(this.object.up).setLength(h.y)),this.object.position.add(_),this.target.add(_),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(h.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){l.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let t=l.length();t?(this._eye.copy(this.object.position).sub(this.target),w.copy(this._eye).normalize(),m.copy(this.object.up).normalize(),g.crossVectors(m,w).normalize(),m.setLength(this._moveCurr.y-this._movePrev.y),g.setLength(this._moveCurr.x-this._movePrev.x),l.copy(m.add(g)),y.crossVectors(l,this._eye).normalize(),t*=this.rotateSpeed,a.setFromAxisAngle(y,t),this._eye.applyQuaternion(a),this.object.up.applyQuaternion(a),this._lastAxis.copy(y),this._lastAngle=t):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),a.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(a),this.object.up.applyQuaternion(a)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let t;this.state===s.TOUCH_ZOOM_PAN?(t=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=f.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(t=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,t!==1&&t>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(t):this.object.isOrthographicCamera?(this.object.zoom=f.clamp(this.object.zoom/t,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(t,i){return p.set((t-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.height),p}_getMouseOnCircle(t,i){return p.set((t-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-i))/this.screen.width),p}_addPointer(t){this._pointers.push(t)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let i=0;i<this._pointers.length;i++)if(this._pointers[i].pointerId==t.pointerId){this._pointers.splice(i,1);return}}_trackPointer(t){let i=this._pointerPositions[t.pointerId];i===void 0&&(i=new n,this._pointerPositions[t.pointerId]=i),i.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const i=t.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[i.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function C(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e))}function j(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function T(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchEnd(e):this._onMouseUp(),this._removePointer(e),this._pointers.length===0&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function k(e){this._removePointer(e)}function D(){this.enabled!==!1&&(this.keyState=s.NONE,window.addEventListener("keydown",this._onKeyDown))}function z(e){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===s.NONE&&(e.code===this.keys[s.ROTATE]&&!this.noRotate?this.keyState=s.ROTATE:e.code===this.keys[s.ZOOM]&&!this.noZoom?this.keyState=s.ZOOM:e.code===this.keys[s.PAN]&&!this.noPan&&(this.keyState=s.PAN)))}function A(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case r.DOLLY:this.state=s.ZOOM;break;case r.ROTATE:this.state=s.ROTATE;break;case r.PAN:this.state=s.PAN;break;default:this.state=s.NONE}const i=this.keyState!==s.NONE?this.keyState:this.state;i===s.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)):i===s.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):i===s.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(E)}function x(e){const t=this.keyState!==s.NONE?this.keyState:this.state;t===s.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY))):t===s.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY)):t===s.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(e.pageX,e.pageY))}function Z(){this.state=s.NONE,this.dispatchEvent(b)}function N(e){if(this.enabled!==!1&&this.noZoom!==!0){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=e.deltaY*.025;break;case 1:this._zoomStart.y-=e.deltaY*.01;break;default:this._zoomStart.y-=e.deltaY*25e-5;break}this.dispatchEvent(E),this.dispatchEvent(b)}}function L(e){this.enabled!==!1&&e.preventDefault()}function U(e){switch(this._trackPointer(e),this._pointers.length){case 1:this.state=s.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=s.TOUCH_ZOOM_PAN;const t=this._pointers[0].pageX-this._pointers[1].pageX,i=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+i*i);const c=(this._pointers[0].pageX+this._pointers[1].pageX)/2,d=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(c,d)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(E)}function R(e){switch(this._trackPointer(e),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY));break;default:const t=this._getSecondPointerPosition(e),i=e.pageX-t.x,c=e.pageY-t.y;this._touchZoomDistanceEnd=Math.sqrt(i*i+c*c);const d=(e.pageX+t.x)/2,v=(e.pageY+t.y)/2;this._panEnd.copy(this._getMouseOnScreen(d,v));break}}function Y(e){switch(this._pointers.length){case 0:this.state=s.NONE;break;case 1:this.state=s.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=s.TOUCH_ZOOM_PAN;for(let t=0;t<this._pointers.length;t++)if(this._pointers[t].pointerId!==e.pointerId){const i=this._pointerPositions[this._pointers[t].pointerId];this._moveCurr.copy(this._getMouseOnCircle(i.x,i.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(b)}export{X as TrackballControls};
